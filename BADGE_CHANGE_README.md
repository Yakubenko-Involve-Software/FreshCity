# Badge Change Functionality

## Опис функціональності

Після натискання кнопки "Apply" на попапі "Call before delivery warning", бейдж на Timeline змінюється з червоного "Call before delivery" на зелений "Call scheduled".

**НОВЕ:** Секція "Risk Level" тепер також відображається для попапу "Traffic jam risk warning".

**НОВЕ:** Після натискання кнопки "Apply" на попапі "Traffic jam risk", карточка переноситься в розділ "Tomorrow" з відповідними змінами.

**НОВЕ:** Секція "Risk Level" тепер також відображається для попапу "Better to deliver evening warning".

**НОВЕ:** Після натискання кнопки "Apply" на попапі "Better to deliver", маршрут переноситься на вечірній час сьогоднішнього дня (19:00, Warehouse → 20:15).

## Що було реалізовано

### 1. Новий тип бейджа
- Додано новий тип бейджа `call-scheduled` з зеленим кольором
- Кольори: `bg-green-100 text-green-700 hover:bg-green-200`

### 2. Оновлена логіка попапа
- Кнопка "Apply" тепер викликає функцію `applyBadgeAction()` замість `hideBadgePopup()`
- Передаються параметри: `badgeId`, `location`, `stopIndex`, `routeName`

### 3. Секція "Risk Level" для всіх ризикових бейджів
- **Call before delivery**: показує секцію "Risk Level" з червоним кольором
- **Traffic jam risk**: тепер також показує секцію "Risk Level" з червоним кольором
- **Better to deliver**: тепер також показує секцію "Risk Level" з червоним кольором
- Секція відображає відсоток ризику на основі унікальних даних картки

### 4. Розділ "Tomorrow" в Timeline
- Додано новий розділ "Tomorrow" з прикладами карток
- Карточки мають синю ліву рамку та спеціальне стилювання
- Відображається кількість зупинок в розділі "Tomorrow"

### 5. Функція `applyBadgeAction()`
- Обробляє `call-before-delivery`: змінює бейдж на "Call scheduled"
- **НОВЕ:** Обробляє `traffic-jam-risk`: переносить карточку в розділ "Tomorrow"
- **НОВЕ:** Обробляє `better-to-deliver`: переносить маршрут на вечірній час
- Знаходить відповідну картку в timeline за локацією
- Оновлює відповідні лічильники в KPI панелі
- Додає анімацію переходу

### 6. Перенесення карточки в "Tomorrow"
- Клонує карточку з "Traffic jam risk"
- Змінює бейдж на "Tomorrow" з синім кольором
- Додає карточку до розділу "Tomorrow"
- Оновлює лічильник зупинок в "Tomorrow"
- Позначає оригінальну карточку як "Moved to Tomorrow"
- Оновлює лічильник "Stops merged"

### 7. Вечірня доставка для "Better to deliver"
- **НОВЕ:** Змінює час доставки на 19:00 (вечір)
- **НОВЕ:** Змінює час складу на 20:15 (вечір)
- **НОВЕ:** Додає бейдж "Evening delivery" з синім кольором
- **НОВЕ:** Застосовує спеціальне стилювання для вечірніх карток
- **НОВЕ:** Оновлює лічильник "Time saved" (+2 хв)
- **ОНОВЛЕНО:** Індикатор "Evening" видалено за запитом користувача
- **ОНОВЛЕНО:** Анімація годин видалена - час тепер статичний

### 8. CSS стилі
- Додано клас `.badge-transition` для плавних переходів
- Додано клас `.badge-call-scheduled` для зеленого бейджа
- **НОВЕ:** Додано стилі для розділу "Tomorrow" та карток
- **НОВЕ:** Додано стилі для вечірньої доставки
- Анімація перенесення карточки в "Tomorrow"
- Спеціальне стилювання для карток "Tomorrow" та вечірніх карток
- **ОНОВЛЕНО:** Анімація вечірнього часу видалена

### 9. Оновлені дані попапів
- **Call before delivery**: детальна інформація для Campo Grande, Route A, Stop 1
- **Traffic jam risk**: детальна інформація для Campo Grande, Route A, Stop 2
- **Better to deliver**: детальна інформація для Campo Grande, Route A, Stop 1
- Специфічні дані про ризики, рекомендації та дії

## Як це працює

### Call before delivery:
1. Користувач клікає на бейдж "Call before delivery" в timeline
2. Відкривається попап з попередженням та секцією "Risk Level"
3. Користувач натискає кнопку "Apply"
4. Бейдж змінюється на "Call scheduled" з зеленим кольором
5. Лічильник "Calls scheduled" збільшується на 1
6. Попап закривається

### Traffic jam risk:
1. Користувач клікає на бейдж "Traffic jam risk" в timeline
2. Відкривається попап з попередженням та секцією "Risk Level"
3. Користувач натискає кнопку "Apply"
4. **НОВЕ:** Карточка клонується та переноситься в розділ "Tomorrow"
5. Бейдж змінюється на "Tomorrow" з синім кольором
6. Лічильник "Tomorrow stops" збільшується на 1
7. Лічильник "Stops merged" збільшується на 1
8. Оригінальна карточка позначається як "Moved to Tomorrow"
9. Попап закривається

### Better to deliver:
1. Користувач клікає на бейдж "Better to deliver" в timeline
2. Відкривається попап з попередженням та секцією "Risk Level"
3. Користувач натискає кнопку "Apply"
4. **НОВЕ:** Час доставки змінюється на 19:00 (вечір)
5. **НОВЕ:** Час складу змінюється на 20:15 (вечір)
6. **НОВЕ:** Бейдж змінюється на "Evening delivery" з синім кольором
7. **НОВЕ:** Застосовується спеціальне стилювання для вечірніх карток
8. **НОВЕ:** Лічильник "Time saved" збільшується на 2 хв
9. Попап закривається

## Тестування

### test_badge_change.html
- Симулює timeline картку з бейджем "Call before delivery"
- Показує попап з попередженням та секцією "Risk Level"
- Демонструє зміну бейджа при натисканні "Apply"

### test_traffic_risk_popup.html
- Симулює timeline картку з бейджем "Traffic jam risk"
- Показує попап з попередженням та секцією "Risk Level"
- Демонструє дію "Apply" для traffic jam risk

### test_tomorrow_section.html
- **НОВИЙ:** Симулює повний timeline з розділом "Tomorrow"
- Демонструє перенесення карточки в "Tomorrow" після натискання "Apply"
- Показує всі ефекти: анімацію, зміну бейджа, оновлення лічильників

### test_evening_delivery.html
- **НОВИЙ:** Симулює timeline з картками для вечірньої доставки
- Демонструє зміну часу на вечірній (19:00, Warehouse → 20:15)
- Показує всі ефекти: зміну часу, бейджа, стилювання, оновлення лічильників

## Файли, що були змінені

- `ai-widget.js` - основна логіка функціональності + розділ "Tomorrow" + перенесення карточки + вечірня доставка
- `style.css` - CSS стилі для нових бейджів + стилі для "Tomorrow" розділу + стилі для вечірньої доставки
- `test_badge_change.html` - тестовий файл для Call before delivery
- `test_traffic_risk_popup.html` - тестовий файл для Traffic jam risk
- `test_tomorrow_section.html` - тестовий файл для розділу "Tomorrow"
- `test_evening_delivery.html` - **НОВИЙ** тестовий файл для вечірньої доставки

## Технічні деталі

- Використовується Tailwind CSS для стилізації
- Анімації через CSS transitions та JavaScript
- Пошук елементів через DOM селектори
- Логування в консоль для відлагодження
- Секція "Risk Level" показується для `call-before-delivery`, `traffic-jam-risk` та `better-to-deliver`
- Унікальні дані генеруються для кожної картки на основі локації, маршруту та позиції
- **НОВЕ:** Розділ "Tomorrow" автоматично генерується з прикладами карток
- **НОВЕ:** Карточки клонуються та переносяться в "Tomorrow" з анімацією
- **НОВЕ:** Оригінальні карточки позначаються як перенесені та стають неактивними
- **НОВЕ:** Вечірня доставка змінює час на 19:00 та 20:15 з анімацією
- **НОВЕ:** Вечірні картки мають спеціальне стилювання та індикатори
