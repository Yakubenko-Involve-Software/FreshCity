# Badge Change Functionality

## Опис функціональності

Після натискання кнопки "Apply" на попапі "Call before delivery warning", бейдж на Timeline змінюється з червоного "Call before delivery" на зелений "Call scheduled".

**НОВЕ:** Секція "Risk Level" тепер також відображається для попапу "Traffic jam risk warning".

**НОВЕ:** Після натискання кнопки "Apply" на попапі "Traffic jam risk", карточка переноситься в розділ "Tomorrow" з відповідними змінами.

## Що було реалізовано

### 1. Новий тип бейджа
- Додано новий тип бейджа `call-scheduled` з зеленим кольором
- Кольори: `bg-green-100 text-green-700 hover:bg-green-200`

### 2. Оновлена логіка попапа
- Кнопка "Apply" тепер викликає функцію `applyBadgeAction()` замість `hideBadgePopup()`
- Передаються параметри: `badgeId`, `location`, `stopIndex`, `routeName`

### 3. Секція "Risk Level" для всіх ризикових бейджів
- **Call before delivery**: показує секцію "Risk Level" з червоним кольором
- **Traffic jam risk**: тепер також показує секцію "Risk Level" з червоним кольором
- Секція відображає відсоток ризику на основі унікальних даних картки

### 4. Розділ "Tomorrow" в Timeline
- Додано новий розділ "Tomorrow" з прикладами карточок
- Карточки мають синю ліву рамку та спеціальне стилювання
- Відображається кількість зупинок в розділі "Tomorrow"

### 5. Функція `applyBadgeAction()`
- Обробляє `call-before-delivery`: змінює бейдж на "Call scheduled"
- **НОВЕ:** Обробляє `traffic-jam-risk`: переносить карточку в розділ "Tomorrow"
- Знаходить відповідну картку в timeline за локацією
- Оновлює відповідні лічильники в KPI панелі
- Додає анімацію переходу

### 6. Перенесення карточки в "Tomorrow"
- Клонує карточку з "Traffic jam risk"
- Змінює бейдж на "Tomorrow" з синім кольором
- Додає карточку до розділу "Tomorrow"
- Оновлює лічильник зупинок в "Tomorrow"
- Позначає оригінальну карточку як "Moved to Tomorrow"
- Оновлює лічильник "Stops merged"

### 7. CSS стилі
- Додано клас `.badge-transition` для плавних переходів
- Додано клас `.badge-call-scheduled` для зеленого бейджа
- **НОВЕ:** Додано стилі для розділу "Tomorrow" та карток
- Анімація перенесення карточки в "Tomorrow"
- Спеціальне стилювання для карток "Tomorrow"

### 8. Оновлені дані попапів
- **Call before delivery**: детальна інформація для Campo Grande, Route A, Stop 1
- **Traffic jam risk**: детальна інформація для Campo Grande, Route A, Stop 2
- Специфічні дані про ризики, рекомендації та дії

## Як це працює

### Call before delivery:
1. Користувач клікає на бейдж "Call before delivery" в timeline
2. Відкривається попап з попередженням та секцією "Risk Level"
3. Користувач натискає кнопку "Apply"
4. Бейдж змінюється на "Call scheduled" з зеленим кольором
5. Лічильник "Calls scheduled" збільшується на 1
6. Попап закривається

### Traffic jam risk:
1. Користувач клікає на бейдж "Traffic jam risk" в timeline
2. Відкривається попап з попередженням та секцією "Risk Level"
3. Користувач натискає кнопку "Apply"
4. **НОВЕ:** Карточка клонується та переноситься в розділ "Tomorrow"
5. Бейдж змінюється на "Tomorrow" з синім кольором
6. Лічильник "Tomorrow stops" збільшується на 1
7. Лічильник "Stops merged" збільшується на 1
8. Оригінальна карточка позначається як "Moved to Tomorrow"
9. Попап закривається

## Тестування

### test_badge_change.html
- Симулює timeline картку з бейджем "Call before delivery"
- Показує попап з попередженням та секцією "Risk Level"
- Демонструє зміну бейджа при натисканні "Apply"

### test_traffic_risk_popup.html
- Симулює timeline картку з бейджем "Traffic jam risk"
- Показує попап з попередженням та секцією "Risk Level"
- Демонструє дію "Apply" для traffic jam risk

### test_tomorrow_section.html
- **НОВИЙ:** Симулює повний timeline з розділом "Tomorrow"
- Демонструє перенесення карточки в "Tomorrow" після натискання "Apply"
- Показує всі ефекти: анімацію, зміну бейджа, оновлення лічильників

## Файли, що були змінені

- `ai-widget.js` - основна логіка функціональності + розділ "Tomorrow" + перенесення карточки
- `style.css` - CSS стилі для нових бейджів + стилі для "Tomorrow" розділу
- `test_badge_change.html` - тестовий файл для Call before delivery
- `test_traffic_risk_popup.html` - тестовий файл для Traffic jam risk
- `test_tomorrow_section.html` - **НОВИЙ** тестовий файл для розділу "Tomorrow"

## Технічні деталі

- Використовується Tailwind CSS для стилізації
- Анімації через CSS transitions та JavaScript
- Пошук елементів через DOM селектори
- Логування в консоль для відлагодження
- Секція "Risk Level" показується для `call-before-delivery` та `traffic-jam-risk`
- Унікальні дані генеруються для кожної картки на основі локації, маршруту та позиції
- **НОВЕ:** Розділ "Tomorrow" автоматично генерується з прикладами карток
- **НОВЕ:** Карточки клонуються та переносяться в "Tomorrow" з анімацією
- **НОВЕ:** Оригінальні карточки позначаються як перенесені та стають неактивними
